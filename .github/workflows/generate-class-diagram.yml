name: Generate Class Diagram

on:
  workflow_call:
    inputs:
      commit_message:
        required: false
        type: string
        default: "chore(diagram): update class diagram"
      diagram_path:
        required: false
        type: string
        default: docs/class-diagram.puml

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'

      # Exemplo: usa jQAssistant + PlantUML (substitui pelo teu gerador preferido)
      - name: Install graph generator deps
        run: |
          sudo apt-get update
          sudo apt-get install -y graphviz

      - name: Generate PlantUML from Java
        run: |
          ./mvnw -q -DskipTests package
          # Coloca aqui o teu comando de geração do diagrama
          # Exemplo fictício: ./tools/gen-uml.sh src/main/java > "${{ inputs.diagram_path }}"
          echo "@startuml" > "${{ inputs.diagram_path }}"
          echo "' TODO: substituir por gerador real" >> "${{ inputs.diagram_path }}"
          echo "@enduml" >> "${{ inputs.diagram_path }}"

      - name: Commit & push
        run: |
          if git diff --quiet -- "${{ inputs.diagram_path }}"; then
            echo "No changes in diagram."
          else
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add "${{ inputs.diagram_path }}"
            git commit -m "${{ inputs.commit_message }}"
            git push
          fi
